---
title: "R Notebook"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "C:/Users/dex78/Documents/Dexter/Projects/Brazil-Forest-Fires-2018/forest_fire_app")
options(warn=-1)
```

This notebook is for annotating my process for creating my shiny app. The app will be capable of generating maps (ideally cloropleths) for the Amazon/Brazil Forest fire data.

I was initially going to download geojson for Brazil's provinces, but soon after found that the makers of ggplot also created ggmap. ggmap allows fairly easy mapping without the need to download geographic data directly. I might change using this down the road since I wouldn't want to publish my API key or get charged if someone were to make a large amount of requests to my account. 

After a bit of searching, I've discovered the CRAN package "brazilmaps", however this is not a widely used package and uses S4 objects, which I am not yet familiar with. That's the next thing to learn about so that I can actually make the cloropleth which is by far the graph most foreign to me. The rest I've implemented before at work and will work on once I have more time. 

Recently I've been busy with fencing (training and tournaments), working on my resume and other personal (non-coding) projects. My work term report for this coop term is also on my mind.

Now that I've gotten a handle on the format of brazil maps and can map by state:
```{r, message=F}
library(brazilmaps)
# must be loaded for get_brmap to work
library(sf)
map_states <- get_brmap(geo = "State", class = "sf")
plot_brmap(map_states)
```

I need to determine how to overlap this data with the Kaggle data. Looking at map_states' names, I found "nome" ("name" in Portuguese) and "state" from the Kaggle data represent the names of Brazil's states. I also noticed that the Kaggle data was not in all caps and the vector type was not in factors, which is easy enough to fix.

Great, now to test how our current data maps onto the states. This can be joined done with the plot_brmap function, given some extra parameters:

```{r, warning=F}
BR_fire_data <- read.csv('../amazon.csv')
BR_fire_data$state <- as.factor(toupper(BR_fire_data$state))
plot_brmap(map_states,
           data_to_join = BR_fire_data,
           join_by = c('nome'='state'),
           var = 'number')
```

While this does show a cloropleth map, it doesn't show as many provinces as we might have expected. Maybe there's a discresion in the names - let's check.

```{r}
# Print the province names from each vector of factors
cat(paste('Levels from Kaggle data:',
          paste0(levels(BR_fire_data$state), collapse=", "),
          '',
          'Levels from brazilmaps:',
          paste0(levels(map_states$nome), collapse=", "),
          sep = '\n'))
```

After looking at the levels, a clear difference is the accents for the names generated by the brazilmaps package. Is it the only difference? Even if we hadn't noticed that the brazilmaps levels list is longer, we can spot the differences in the two lists with the following code:
"RIO DE JANEIRO", "RIO GRANDE DO NORTE" and "RIO GRANDE DO SUL".

```{r}
# remove accents
levels(map_states$nome) <- iconv(levels(map_states$nome),from="UTF-8",to="ASCII//TRANSLIT")
levels(BR_fire_data$state) <- iconv(levels(BR_fire_data$state),from="UTF-8",to="ASCII//TRANSLIT")

# return vector of state names in brazilmaps that are not in Kaggle
cat("In brazilmaps but not Kaggle:\n")
cat(
  paste0(
    setdiff(
      levels(map_states$nome),
      levels(BR_fire_data$state)),
    collapse=", "
    )
  )

# Equivalent, except from Kaggle to brazilmaps
cat("\n\nIn Kaggle but not brazilmaps:\n")
cat(
  paste0(
    setdiff(
      levels(BR_fire_data$state), 
      levels(map_states$nome)),
    collapse=", "
    )
  )
```



